services:
  # REST Provider - Physical Products
  rest-provider:
    build:
      context: ./mock-providers/rest-provider
      dockerfile: Dockerfile
    container_name: allconnect-rest-provider
    ports:
      - "4001:4001"
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ASPNETCORE_URLS=http://+:4001
    networks:
      - integration-network
      - allconnect-network

  # SOAP Provider - Professional Services
  soap-provider:
    build:
      context: ./mock-providers/soap-provider
      dockerfile: Dockerfile
    container_name: allconnect-soap-provider
    ports:
      - "4002:4002"
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ASPNETCORE_URLS=http://+:4002
    networks:
      - integration-network
      - allconnect-network

  # gRPC Provider - Digital Subscriptions
  grpc-provider:
    build:
      context: ./mock-providers/grpc-provider
      dockerfile: Dockerfile
    container_name: allconnect-grpc-provider
    ports:
      - "4003:4003"
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ASPNETCORE_URLS=http://+:4003
    networks:
      - integration-network
      - allconnect-network

  # Integration Service - Spring Boot
  integration-service:
    build:
      context: ./integration-service
      dockerfile: Dockerfile
    container_name: allconnect-integration
    ports:
      - "8086:8085"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
    depends_on:
      rest-provider:
        condition: service_started
      soap-provider:
        condition: service_started
      grpc-provider:
        condition: service_started
    networks:
      - integration-network
      - allconnect-network

networks:
  integration-network:
    driver: bridge
  allconnect-network:
    external: true
    name: allconnect-network
